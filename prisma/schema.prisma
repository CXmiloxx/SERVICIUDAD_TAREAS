generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum TipoDocumento {
  CC
  TI
  CE
  PASAPORTE
}

enum EstadoUsuario {
  ACTIVO
  INACTIVO
}

enum Estado {
  ACTIVO
  INACTIVO
  ARCHIVADO
}

enum TipoContrato {
  CONTRATO_APOYO_GESTION
  CONTRATO_PROFESIONAL
}

enum TipoPretension {
  DETERMINADAS
  INDETERMINADAS
}

enum Calidad {
  DEMANDADO
  DEMANDANTE
  VINCULADO
}

enum Rol {
  GOBERNACION
  SECRETARIA
  SUPERVISOR
  FUNCIONARIO
  CONTRATISTA
}

enum NotificacionTipo {
  CONTRATO_EXPIRANDO
  EVENTO_CALENDARIO
  ACTUALIZACION_ACTUACIONES_PROCESO_JUDICIAL
  ACTUALIZACION_ACTUACIONES_SEGUNDA_INSTANCIA
}

model Actuaciones {
  id                Int       @id @default(autoincrement())
  nroRadicado       String
  fechaActuacion    DateTime
  actuacion         String    @db.Text
  anotacion         String    @db.Text
  fechaInicio       DateTime?
  fechaFinalizado   DateTime?
  fechaNovedad      DateTime?
  fechaRegistro     DateTime?
  procesoJuducialId Int?

  procesoJudicial ProcesoJudicial? @relation(fields: [procesoJuducialId], references: [id])
}

model ActuacionesSegundaInstancia {
  id                 Int       @id @default(autoincrement())
  nroRadicado        String
  fechaActuacion     DateTime
  actuacion          String    @db.Text
  anotacion          String    @db.Text
  fechaInicio        DateTime?
  fechaFinalizado    DateTime?
  fechaNovedad       DateTime?
  fechaRegistro      DateTime?
  segundaInstanciaId Int?

  segundaInstancia SegundaInstancia? @relation(fields: [segundaInstanciaId], references: [id])
}

model Usuario {
  id                                Int                             @id @default(autoincrement())
  nombre                            String
  apellido                          String
  documento                         String
  tipoDocumento                     TipoDocumento
  correoElectronico                 String                          @unique
  telefono                          String?
  contrasena                        String
  estado                            EstadoUsuario                   @default(ACTIVO)
  fechaRegistro                     DateTime                        @default(now())
  secretariaId                      Int?
  rol                               Rol?
  secretaria                        Secretaria?                     @relation(fields: [secretariaId], references: [id])
  contrato                          Contrato?
  usuarioProceso                    UsuarioProceso[]
  codigoUsuario                     Int?
  intentosCodigo                    Int?
  revisionesLegalesProcesoJudicial  RevisionLegal[]                 @relation("revisionesLegalesProcesoJudicialCreador")
  eventosCalendario                 EventosCalendario[]
  revisionesLegalesSegundaInstancia RevisionLegalSegundaInstancia[] @relation("RevisionLegalSegundaInstanciaCreador")
  notificaciones                    Notificaciones[]
  auditoriaLogs                     AuditoriaLog[]
}

model Secretaria {
  id       Int               @id @default(autoincrement())
  nombre   String
  usuarios Usuario[]
  procesos ProcesoJudicial[]
}

model Contrato {
  id           Int          @id @default(autoincrement())
  tipoContrato TipoContrato @default(CONTRATO_APOYO_GESTION)
  fechaInicio  DateTime?
  fechaFin     DateTime?
  usuarioId    Int          @unique

  usuario Usuario @relation(fields: [usuarioId], references: [id])
}

model ProcesoJudicial {
  id                       Int            @id @default(autoincrement())
  radicado                 String
  calidad                  Calidad
  demandante               String
  demandado                String
  fechaAdmisionDemanda     DateTime?
  fechaNotificacion        DateTime?
  jurisdiccionId           Int?
  secretariaDespachoId     Int?
  accionJudicialId         Int?
  corporacionId            Int?
  montoPretension          Float?
  usuarioProcesoId         Int?
  tipoPretension           TipoPretension
  autoridadAccionJudicial String? @db.Text
  medidaCautelar           String?
  valorMedidaCautelar      Float?
  montoTotalProceso        Float?
  estado                   Estado
  numeroCedula             String?
  despachoJudicial         String?
  sintesis                 String?        @db.Text
  dependenciaResponsableId Int?
  hechoGeneradorId         Int?
  fechaProbableFallo       DateTime?
  etapaProceso             String?
  falloPrimeraInstancia    String?
  fechaFallo               DateTime?
  fechaApelacion           DateTime?
  fechaNotificacionFallo   DateTime?
  apelacion                String?
  apelacionContraparte     String?

  // Campos de riesgo
  fortalezaDefensaId    Int?
  fortalezaProbatoriaId Int?
  riesgoProcesalId      Int?
  nivelJurisprudenciaId Int?
  nombreEntidadesVinculadas String?

  // Relaciones principales
  jurisdiccion           Jurisdiccion?           @relation(fields: [jurisdiccionId], references: [id])
  secretariaDespacho     Secretaria?             @relation(fields: [secretariaDespachoId], references: [id])
  accionJudicial         AccionJudicial?         @relation(fields: [accionJudicialId], references: [id])
  corporacion            Corporacion?            @relation(fields: [corporacionId], references: [id])
  usuarioProceso         UsuarioProceso[]
  dependenciaResponsable DependenciaResponsable? @relation(fields: [dependenciaResponsableId], references: [id])
  hechoGenerador         HechoGenerador?         @relation(fields: [hechoGeneradorId], references: [id])

  // Relaciones con NivelRiesgo (todas consistentes)
  fortalezaDefensaNivel    NivelRiesgo? @relation("FortalezaDefensaNivel", fields: [fortalezaDefensaId], references: [id])
  fortalezaProbatoriaNivel NivelRiesgo? @relation("FortalezaProbatoriaNivel", fields: [fortalezaProbatoriaId], references: [id])
  riesgoProcesalNivel      NivelRiesgo? @relation("RiesgoProcesalNivel", fields: [riesgoProcesalId], references: [id])
  jurisprudenciaNivel      NivelRiesgo? @relation("JurisprudenciaNivel", fields: [nivelJurisprudenciaId], references: [id])

  documentos       DocumentoProcesoJudicial[]
  SegundaInstancia SegundaInstancia[]
  actuaciones      Actuaciones[]
  comentarios      Comentarios[]
  revisionLegal    RevisionLegal[]
}

model NivelRiesgo {
  id     Int    @id @default(autoincrement())
  nombre String

  fortalezasDefensa     ProcesoJudicial[] @relation("FortalezaDefensaNivel")
  fortalezasProbatorias ProcesoJudicial[] @relation("FortalezaProbatoriaNivel")
  riesgosProcesales     ProcesoJudicial[] @relation("RiesgoProcesalNivel")
  jurisprudencias       ProcesoJudicial[] @relation("JurisprudenciaNivel")
}

model UsuarioProceso {
  id                Int      @id @default(autoincrement())
  fechaVinculacion  DateTime
  usuarioId         Int
  procesoJudicialId Int

  usuario         Usuario         @relation(fields: [usuarioId], references: [id])
  procesoJudicial ProcesoJudicial @relation(fields: [procesoJudicialId], references: [id])
}

model SegundaInstancia {
  id                            Int      @id @default(autoincrement())
  radicado                      String
  jurisdiccionId                Int
  corporacionSegundaInstanciaId Int
  despacho                      String
  etapaProceso                  String
  fechaFallo                    DateTime?
  fechaNotificacionFallo        DateTime?
  fallo                         String?
  terminoFallo                  String
  tipoTerminoFallo              String?
  tiempoFallo                   Int?
  transcripcionOrdenJudicial    String?  @db.Text
  costas                        String
  valorCostas                   Int?

  recursosSolicitudesFrenteDecisionesJudiciales String
  tipoRecurso                                   String?
  resolucionPagoSentencia                       String?
  procesoJudicialId                             Int
  cumplimiento                                  String
  estadoFinalProceso                            String
  idRecursoEconomico                            Int?

  // Relaciones
  jurisdiccion    Jurisdiccion                @relation(fields: [jurisdiccionId], references: [id])
  corporacion     CorporacionSegundaInstancia @relation(fields: [corporacionSegundaInstanciaId], references: [id])
  procesoJudicial ProcesoJudicial             @relation(fields: [procesoJudicialId], references: [id])
  recursoEconomico         RecursoEconomico? @relation(fields: [idRecursoEconomico], references: [id])

  documentos                     DocumentosSegundaInstancia[]
  comentarios                    ComentariosSegundaInstancia[]
  TerceraInstancia               TerceraInstancia[]
  actuacionesSegundaInstancias   ActuacionesSegundaInstancia[]
  revisionLegalSegundaInstancias RevisionLegalSegundaInstancia[]
}

model ComentariosSegundaInstancia {
  id                 Int              @id @default(autoincrement())
  segundaInstanciaId Int
  comentario         String           @db.Text
  creadoEn           DateTime         @default(now())
  actualizadoEn      DateTime         @updatedAt
  segundaInstancia   SegundaInstancia @relation(fields: [segundaInstanciaId], references: [id])
}

model DocumentosSegundaInstancia {
  id                 Int              @id @default(autoincrement())
  segundaInstanciaId Int              @unique
  segundaInstancia   SegundaInstancia @relation(fields: [segundaInstanciaId], references: [id])

  cuentaCobroDemandante         String?
  oficioPagoDecreto2469         String?
  proyectoResolucionOrdenPago   String?
  documentosListaChequeo        String?
  solicitudCDP                  String?
  certificadoCDP                String?
  cargueSAIA                    String?
  liquidacionProceso            String?
  resolucionOrdenPago           String?
  solicitudRegistroPresupuestal String?
  registroPresupuestal          String?
  solicitudPago                 String?
  soportePagoTesoreria          String?

  fechaCreacion      DateTime @default(now())
  fechaActualizacion DateTime @updatedAt
}

model Comentarios {
  id                Int             @id @default(autoincrement())
  procesoJudicialId Int
  comentario        String          @db.Text
  creadoEn          DateTime        @default(now())
  actualizadoEn     DateTime        @updatedAt
  procesoJudicial   ProcesoJudicial @relation(fields: [procesoJudicialId], references: [id])
}

model RevisionLegal {
  id                Int     @id @default(autoincrement())
  procesoJudicialId Int
  contestacion      Boolean @default(false)
  alegato           Boolean @default(false)
  apelacion         Boolean @default(false)
  actuaciones       Boolean @default(false)
  defensaAdecuada   Boolean @default(false)
  terminado         Boolean @default(false)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  creadoPorId Int

  procesoJudicial ProcesoJudicial @relation(fields: [procesoJudicialId], references: [id])
  creadoPor       Usuario         @relation("revisionesLegalesProcesoJudicialCreador", fields: [creadoPorId], references: [id])
}

model RevisionLegalSegundaInstancia {
  id                 Int     @id @default(autoincrement())
  segundaInstanciaId Int
  contestacion       Boolean @default(false)
  alegato            Boolean @default(false)
  apelacion          Boolean @default(false)
  actuaciones        Boolean @default(false)
  defensaAdecuada    Boolean @default(false)
  terminado          Boolean @default(false)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  creadoPorId Int

  segundaInstancia SegundaInstancia @relation(fields: [segundaInstanciaId], references: [id])
  creadoPor        Usuario          @relation("RevisionLegalSegundaInstanciaCreador", fields: [creadoPorId], references: [id])
}

model TerceraInstancia {
  id                 Int @id @default(autoincrement())
  estadoId           Int
  segundaInstanciaId Int

  estado           Estado
  segundaInstancia SegundaInstancia @relation(fields: [segundaInstanciaId], references: [id])
}

model Jurisdiccion {
  id                           Int                           @id @default(autoincrement())
  nombre                       String
  fechaCreacion                DateTime                      @default(now())
  procesos                     ProcesoJudicial[]
  corporaciones                Corporacion[]
  accionesJudiciales           AccionJudicial[]
  segundaInstancias            SegundaInstancia[]
  corporacionSegundaInstancias CorporacionSegundaInstancia[]
}

model Corporacion {
  id             Int    @id @default(autoincrement())
  nombre         String
  jurisdiccionId Int

  jurisdiccion Jurisdiccion      @relation(fields: [jurisdiccionId], references: [id])
  procesos     ProcesoJudicial[]
}

model CorporacionSegundaInstancia {
  id             Int    @id @default(autoincrement())
  nombre         String
  jurisdiccionId Int

  jurisdiccion             Jurisdiccion       @relation(fields: [jurisdiccionId], references: [id])
  procesosSegundaInstancia SegundaInstancia[]
}

model DependenciaResponsable {
  id       Int               @id @default(autoincrement())
  nombre   String            @db.VarChar(255)
  procesos ProcesoJudicial[]
}

model HechoGenerador {
  id       Int               @id @default(autoincrement())
  nombre   String            @db.VarChar(255)
  procesos ProcesoJudicial[]
}

model AccionJudicial {
  id             Int      @id @default(autoincrement())
  nombre         String
  fechaCreacion  DateTime @default(now())
  jurisdiccionId Int

  jurisdiccion Jurisdiccion      @relation(fields: [jurisdiccionId], references: [id])
  procesos     ProcesoJudicial[]
}

model DocumentoProcesoJudicial {
  id                Int      @id @default(autoincrement())
  rutaRelativa      String
  nombre            String
  fechaCreacion     DateTime @default(now())
  creador           String
  procesoJudicialId Int

  procesoJudicial ProcesoJudicial @relation(fields: [procesoJudicialId], references: [id])
}

model EventosCalendario {
  id          Int      @id @default(autoincrement())
  titulo      String
  descripcion String   @db.Text
  fechaEvento DateTime @default(now())
  usuarioId   Int
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
}

model Notificaciones {
  id        Int              @id @default(autoincrement())
  usuarioId Int
  titulo    String
  mensaje   String           @db.Text
  tipo      NotificacionTipo
  read      Boolean          @default(false)
  createdAt DateTime         @default(now())
  usuario   Usuario          @relation(fields: [usuarioId], references: [id])
}

model RecursoEconomico {
  id               Int                @id @default(autoincrement())
  nombre           String
  fechaCreacion    DateTime           @default(now())
  segundasInstancias SegundaInstancia[]
}

enum AccionAuditoria {
  INSERT
  UPDATE
  DELETE
}

model AuditoriaLog {
  id                Int              @id @default(autoincrement())
  tablaAfectada     String           @db.VarChar(100)
  registroId        Int
  accion            AccionAuditoria
  datosAnteriores   Json?
  datosNuevos       Json?
  usuarioId         Int?
  fechaAuditoria    DateTime         @default(now())
  usuario           Usuario?         @relation(fields: [usuarioId], references: [id])

  @@index([tablaAfectada, registroId])
  @@index([fechaAuditoria])
  @@index([usuarioId])
}
